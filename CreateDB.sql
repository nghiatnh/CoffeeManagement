-- SQLite

DROP TABLE IF EXISTS ROLES;
DROP TABLE IF EXISTS CATEGORIES;
DROP TABLE IF EXISTS ORDERSTATES;
DROP TABLE IF EXISTS ORDERDETAILSTATES;
DROP TABLE IF EXISTS TABLESTATES;
DROP TABLE IF EXISTS PRODUCTS;
DROP TABLE IF EXISTS STAFFS;
DROP TABLE IF EXISTS STAFFACCOUNTS;
DROP TABLE IF EXISTS CUSTOMERS;
DROP TABLE IF EXISTS TABLES;
DROP TABLE IF EXISTS ORDERS;
DROP TABLE IF EXISTS ORDERDETAILS;
DROP TABLE IF EXISTS BILLS;

CREATE TABLE ROLES
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(100)
);

CREATE TABLE CATEGORIES
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(100)
);

CREATE TABLE ORDERSTATES
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(100)
);

CREATE TABLE ORDERDETAILSTATES
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(100)
);

CREATE TABLE TABLESTATES
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(100)
);

CREATE TABLE PRODUCTS
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(255),
	IMAGE_URL NVARCHAR,
	IDCATEGORY INTEGER NOT NULL,
	PRICE FLOAT DEFAULT 0,

	FOREIGN KEY (IDCATEGORY) REFERENCES CATEGORIES(ID)
);

CREATE TABLE STAFFS
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(100),
	ADDRESS NVARCHAR,
	PHONE VARCHAR(15),
	CODE VARCHAR(15),
	BIRTHDAY DATETIME,
	SEX NVARCHAR(20),
	IDROLE INTEGER NOT NULL,

	FOREIGN KEY (IDROLE) REFERENCES ROLES(ID)
);

CREATE TABLE STAFFACCOUNTS
(
	ID INTEGER PRIMARY KEY,
	USERNAME VARCHAR(100),
	PASSWORD NVARCHAR,

	FOREIGN KEY (ID) REFERENCES STAFFS(ID)
);

CREATE TABLE CUSTOMERS
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(100),
	ADDRESS NVARCHAR,
	PHONE VARCHAR(15),
	CODE VARCHAR(15),
	BIRTHDAY DATETIME,
	POINT FLOAT DEFAULT 0,
	SEX NVARCHAR(20)
);

CREATE TABLE TABLES
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	NAME NVARCHAR(15),
	IDSTATE INTEGER,

	FOREIGN KEY (IDSTATE) REFERENCES TABLESTATES(ID)
);

CREATE TABLE ORDERS
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	IDTABLE INTEGER,
	IDSTATE INTEGER,

	FOREIGN KEY (IDTABLE) REFERENCES TABLES(ID),
	FOREIGN KEY (IDSTATE) REFERENCES ORDERSTATES(ID)
);

CREATE TABLE ORDERDETAILS
(
	ID INTEGER PRIMARY KEY AUTOINCREMENT,
	COUNT INTEGER,
	ORDERTIME DATETIME,
	IDORDER INTEGER,
	IDPRODUCT INTEGER,
	IDSTATE INTEGER,

	FOREIGN KEY (IDORDER) REFERENCES ORDERS(ID),
	FOREIGN KEY (IDPRODUCT) REFERENCES PRODUCTS(ID),
	FOREIGN KEY (IDSTATE) REFERENCES ORDERDETAILSTATES(ID)
);

CREATE TABLE BILLS
(
	ID INTEGER PRIMARY KEY,
	PAYTIME DATETIME,
	CUSTOMERNAME NVARCHAR(100) NOT NULL,
	IDSTAFF INTEGER,
	IDCUSTOMER INTEGER,

	FOREIGN KEY (IDSTAFF) REFERENCES STAFFS(ID),
	FOREIGN KEY (IDCUSTOMER) REFERENCES CUSTOMERS(ID),
	FOREIGN KEY (ID) REFERENCES ORDERS(ID)
);